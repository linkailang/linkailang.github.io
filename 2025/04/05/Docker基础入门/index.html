<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker基础入门 | 涂良湘</title><meta name="author" content="涂良湘,2698508226@qq.com"><meta name="copyright" content="涂良湘"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker 基础入门一、CentOS7 安装 Docker#查看服务器内核版本 uname -r #查看系统信息 cat &#x2F;etc&#x2F;os-release  #1.yum包更新到最新 sudo yum update #2.安装需要的软件包，yum-util提供yum-config-manager功能，另外两个是devicemapper驱动依赖的 sudo yum install -y yum-ut">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker基础入门">
<meta property="og:url" content="https://linkailang.github.io/2025/04/05/Docker%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="涂良湘">
<meta property="og:description" content="Docker 基础入门一、CentOS7 安装 Docker#查看服务器内核版本 uname -r #查看系统信息 cat &#x2F;etc&#x2F;os-release  #1.yum包更新到最新 sudo yum update #2.安装需要的软件包，yum-util提供yum-config-manager功能，另外两个是devicemapper驱动依赖的 sudo yum install -y yum-ut">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://linkailang.github.io/img/QQ%E5%9B%BE%E7%89%8720230422000755.jpg">
<meta property="article:published_time" content="2025-04-05T14:31:34.000Z">
<meta property="article:modified_time" content="2025-04-05T14:57:03.975Z">
<meta property="article:author" content="涂良湘">
<meta property="article:tag" content="Doceker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://linkailang.github.io/img/QQ%E5%9B%BE%E7%89%8720230422000755.jpg"><link rel="shortcut icon" href="/img/avatar.png"><link rel="canonical" href="https://linkailang.github.io/2025/04/05/Docker%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker基础入门',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-05 22:57:03'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mouse.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/QQ%E5%9B%BE%E7%89%8720230422000755.jpg" onerror="onerror=null;src='/img/avatar.png'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Message/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/Snipaste_2024-01-12_01-49-04.png')"><nav id="nav"><span id="blog-info"><a href="/" title="涂良湘"><span class="site-name">涂良湘</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/Message/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker基础入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-05T14:31:34.000Z" title="发表于 2025-04-05 22:31:34">2025-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-05T14:57:03.975Z" title="更新于 2025-04-05 22:57:03">2025-04-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>54分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker基础入门"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker-基础入门"><a href="#Docker-基础入门" class="headerlink" title="Docker 基础入门"></a>Docker 基础入门</h1><h2 id="一、CentOS7-安装-Docker"><a href="#一、CentOS7-安装-Docker" class="headerlink" title="一、CentOS7 安装 Docker"></a>一、CentOS7 安装 Docker</h2><pre><code class="shell">#查看服务器内核版本
uname -r
#查看系统信息
cat /etc/os-release

#1.yum包更新到最新
sudo yum update
#2.安装需要的软件包，yum-util提供yum-config-manager功能，另外两个是devicemapper驱动依赖的
sudo yum install -y yum-util device-mapper-persistent-data lvm2
#3.设置yum源
#使用官方源地址（比较慢）
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
#建议使用阿里云地址（比较快）
sudo yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
#结果
Loaded plugins: fastestmirror, langpacks
adding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
grabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo
repo saved to /etc/yum.repos.d/docker-ce.repo
#更新yum软件包索引
yum makecache fast
#结果
Loaded plugins: fastestmirror, langpacks
Determining fastest mirrors
docker-ce-stable                                                                                                                                            | 3.5 kB  00:00:00
epel                                                                                                                                                        | 4.7 kB  00:00:00
extras                                                                                                                                                      | 2.9 kB  00:00:00
os                                                                                                                                                          | 3.6 kB  00:00:00
updates                                                                                                                                                     | 2.9 kB  00:00:00
(1/2): docker-ce-stable/7/x86_64/updateinfo                                                                                                                 |   55 B  00:00:00
(2/2): docker-ce-stable/7/x86_64/primary_db                                                                                                                 |  97 kB  00:00:00
Metadata Cache Created
#4.安装docker，出现输入的界面都按Y，出现Complete!便成功了。
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#结果
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
Total download size: 107 M
Installed size: 376 M
#这里选y
Is this ok [y/d/N]: y
Downloading packages:
(1/18): container-selinux-2.119.2-1.911c772.el7_8.noarch.rpm                                                                                                |  40 kB  00:00:00
(2/18): audit-libs-python-2.8.5-4.el7.x86_64.rpm        MB  00:00:59
Retrieving key from https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
Importing GPG key 0x621E9F35:
Userid     : &quot;Docker Release (CE rpm) &lt;docker@docker.com&gt;&quot;
Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35
From       : https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
#这里选y
Is this ok [y/N]: y
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
Warning: RPMDB altered outside of yum.
** Found 2 pre-existing rpmdb problem(s), &#39;yum check&#39; output follows:
······
Installed:
containerd.io.x86_64 0:1.6.16-3.1.el7            docker-buildx-plugin.x86_64 0:0.10.2-1.el7      docker-ce.x86_64 3:23.0.1-1.el7      docker-ce-cli.x86_64 1:23.0.1-1.el7
docker-compose-plugin.x86_64 0:2.16.0-1.el7

Dependency Installed:
audit-libs-python.x86_64 0:2.8.5-4.el7                      checkpolicy.x86_64 0:2.5-8.el7                       container-selinux.noarch 2:2.119.2-1.911c772.el7_8
docker-ce-rootless-extras.x86_64 0:23.0.1-1.el7             docker-scan-plugin.x86_64 0:0.23.0-3.el7             fuse-overlayfs.x86_64 0:0.7.2-6.el7_8
fuse3-libs.x86_64 0:3.6.1-4.el7                             libcgroup.x86_64 0:0.41-21.el7                       libsemanage-python.x86_64 0:2.5-14.el7
policycoreutils-python.x86_64 0:2.5-34.el7                  python-IPy.noarch 0:0.75-6.el7                       setools-libs.x86_64 0:3.3.8-4.el7
slirp4netns.x86_64 0:0.4.3-4.el7_8

Complete!

#5.查看docker版本，验证是否安装成功
sudo docker version
#结果
Client: Docker Engine - Community
Version:           23.0.1
API version:       1.42
Go version:        go1.19.5
Git commit:        a5ee5b1
Built:             Thu Feb  9 19:51:00 2023
OS/Arch:           linux/amd64
Context:           default

Server: Docker Engine - Community
Engine:
Version:          23.0.1
API version:      1.42 (minimum version 1.12)
Go version:       go1.19.5
Git commit:       bc3805a
Built:            Thu Feb  9 19:48:42 2023
OS/Arch:          linux/amd64
Experimental:     false
containerd:
Version:          1.6.16
GitCommit:        31aa4358a36870b21a992d3ad2bef29e1d693bec
runc:
Version:          1.1.4
GitCommit:        v1.1.4-0-g5fd4c4d
docker-init:
Version:          0.19.0
GitCommit:        de40ad0

#6.启动docker
sudo systemctl start docker

#7.通过运行hello-world映像来验证 Docker 引擎安装是否成功。
sudo docker run hello-world
#结果
Unable to find image &#39;hello-world:latest&#39; locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete
Digest: sha256:aa0cc8055b82dc2509bed2e19b275c8f463506616377219d9642221ab53cf9fe
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:

1. The Docker client contacted the Docker daemon.
2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
   (amd64)
3. The Docker daemon created a new container from that image which runs the
   executable that produces the output you are currently reading.
4. The Docker daemon streamed that output to the Docker client, which sent it
   to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
$ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
https://hub.docker.com/

For more examples and ideas, visit:
https://docs.docker.com/get-started/

#8.停止docker
#虽然停止了docker服务，但是docker服务在关闭状态下有被访问自动唤醒的机制，即这时再执行任意docker命令会直接启动docker服务
sudo systemctl stop docker
#如果真的不希望docker被访问自动唤醒，需要把守护进程服务也关掉
sudo systemctl stop docker.socket
#查看docker是否真被关掉，查看docker状态
sudo systemctl status docker
</code></pre>
<p>卸载 docker：</p>
<pre><code class="shell">#1.卸载依赖
sudo yum remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras
#2.删除资源目录（/var/lib/docker   docker的默认工作路径）
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
</code></pre>
<h2 id="二、Docker-的基本命令"><a href="#二、Docker-的基本命令" class="headerlink" title="二、Docker 的基本命令"></a>二、Docker 的基本命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><pre><code class="shell">docker version #显示docker的版本信息
docker info #显示docker的系统信息，包括镜像和容器的数量
docker 命令 --help #万能命令
</code></pre>
<p>帮助文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/cli/docker/">docker | Docker Docs</a></p>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><p>docker images 查看所有本地的主机上的镜像</p>
<pre><code class="shell">[lighthouse@VM-16-5-centos /]$ sudo docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    feb5d9fea6a5   16 months ago   13.3kB

# 解释

REPOSITORY  # 镜像的仓库源
TAG         # 镜像的标签
IMAGE ID    # 镜像的id
CREATED     # 镜像的创建时间
SIZE        # 镜像的大小

# 可选项

-a, --all    # 列出所有镜像
-q, --quiet  # 只显示镜像的id
</code></pre>
<p>docker search 搜索镜像</p>
<pre><code class="shell">[lighthouse@VM-16-5-centos /]$ sudo docker search mysql
NAME                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                           MySQL is a widely used, open-source relation…   13780     [OK]       
mariadb                         MariaDB Server is a high performing open sou…   5262      [OK]       
percona                         Percona Server is a fork of the MySQL relati…   599       [OK]       
phpmyadmin                      phpMyAdmin - A web interface for MySQL and M…   734       [OK]       
circleci/mysql                  MySQL is a widely used, open-source relation…   28                   
bitnami/mysql                   Bitnami MySQL Docker Image                      80                   [OK]
bitnami/mysqld-exporter                                                         4                    
ubuntu/mysql                    MySQL open source fast, stable, multi-thread…   41                   

# 可选项，通过收藏数来过滤

--filter=STARS=3000  #搜索出来的镜像就是收藏数大于3000的。
</code></pre>
<p>docker pull 下载镜像</p>
<pre><code class="shell">#下载镜像 docker pull 镜像名:tag
[lighthouse@VM-16-5-centos /]$ sudo docker pull mysql:5.7
5.7: Pulling from library/mysql #如果哦不写tag，默认就是最新版本
e048d0a38742: Pull complete #分层下载docker image的核心，联合文件系统
c7847c8a41cb: Pull complete 
351a550f260d: Pull complete 
8ce196d9d34f: Pull complete 
17febb6f2030: Pull complete 
d4e426841fb4: Pull complete 
fda41038b9f8: Pull complete 
f47aac56b41b: Pull complete 
a4a90c369737: Pull complete 
97091252395b: Pull complete 
84fac29d61e9: Pull complete 
Digest: sha256:8cf035b14977b26f4a47d98e85949a7dd35e641f88fc24aa4b466b36beecf9d6  #签名
Status: Downloaded newer image for mysql:5.7
docker.io/library/mysql:5.7 #真实地址
</code></pre>
<p>docker rmi -f [镜像 ID] 删除镜像</p>
<pre><code class="shell">#删除镜像
[lighthouse@VM-16-5-centos /]$ sudo docker rmi -f 57da161f45ac #删除指定的镜像
Untagged: mysql:latest
Untagged: mysql@sha256:8653a170e0b0df19ea95055267def2615fc53c62df529e3750817c1a886485f0
Deleted: sha256:57da161f45ac3835bc872dcb50f0cde87f65661ba8f50a5a0835dee7e262703f
Deleted: sha256:9e4b6222a6cefc0be6e8ade3cd1692188b6eecf71fcc2568a693c0e630614a0a
Deleted: sha256:b1cc52ec5ce1f3261dbe86f7b09bb70061e71ece8b9a2864ed847187ddc7605a
Deleted: sha256:06bb8fe22fec310fc5dabc4298e23b46b579d3a7d91413e18229195fe5f54436
Deleted: sha256:1d45093bae7b3d23220a568d07cbee31bdc66e78b4a08d509684faa2500a4adc
Deleted: sha256:a1631c5cec986cf56dfddd8f902a7c79052a0157d4ba325bb28f62c909d0e8ae
Deleted: sha256:5020329708536d258b967ba499c93ce57ca8612b4b78c49d25c2a4a6ad5c8407
Deleted: sha256:02ced332f0c6778bf91754fde67302bbc07bc5933b48a92c77b4576e984e55e8
Deleted: sha256:b289f85ed3850442cb04b1f1f9b7a7409d88a43d277000cdb4f0e6e775a42a65
Deleted: sha256:097c8299fba37fe21a9561d58e1e423d89873064b716aa74c233590db9c6db86
Deleted: sha256:ea6feaa089dca094ae502b77cc9ffc86d2e42cd3fbe1a91d38ecf2064de7ac05
Deleted: sha256:9cd9df9ffc972e9abc946d855162ef0c40dff9a89f10c962b7920154a3d943d8

#删除多个镜像
sudo docker rmi -f 镜像id 镜像id 镜像id
#删除所有镜像
sudo docker rmi -f $(docker images -aq)
</code></pre>
<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>新建容器并启动（前提是已经下好了镜像）</p>
<pre><code class="shell">#新建容器并启动
docker run [可选参数] image:[tag]

#参数说明
--name=&quot;Name&quot;  #容器名字，tomcat01、tomcat02用来区分容器
-d             #后台方式运行
-it            #使用交互方式运行，比如进入容器查看内容
-p             #指定容器端口，比如 -p 8080 指定8080端口运行容器；也可以和主机端口映射，比如 -p 80:8080。
    -p ip:主机端口:容器端口
    -p 主机端口:容器端口（常用）
    -p 容器端口
-P             #大P 随机指定运行的端口。
-e             #环境配置修改，列如：-e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; 修改内存最小占用64M和最大占用512M。

#启动并进入容器
sudo docker run -it mysql:5.7
</code></pre>
<p>列出所有运行中的容器</p>
<pre><code class="shell">#列出所有正在运行的容器
sudo docker ps

#列出所有运行中容器+带出历史运行过得容器
sudo docker ps -a
sudo docker ps -aq #只显示所有容器的id
#显示最近创建的容器, ? 为显示的个数
sudo docker ps -n=?
</code></pre>
<p>退出容器</p>
<p>SHELL</p>
<pre><code class="shell">#停止并退出容器
exit
#容器不停止并退出
快捷键 Ctrl + P + Q
</code></pre>
<p>删除容器</p>
<pre><code class="shell">sudo docker rm 容器id                    #删除指定的容器，不能删除正在运行的容器，如果要强制删除使用 rm -f。
sudo docker rm -f $(docker ps -aq)      #删除所有容器
sudo docker ps -a -q|xargs docker rm    #删除所有容器
</code></pre>
<p>启动和停止容器的操作</p>
<pre><code class="shell">sudo docker start 容器id      #启动一个已经停止了的容器
sudo docker restart 容器id    #重启容器
sudo docker stop 容器id       #停止当前正在运行的容器
sudo docker kill 容器id       #强制停止容器，杀掉容器
</code></pre>
<p>查看容器使用主机资源</p>
<pre><code class="shell">sudo docker stats 容器id     #可以看到运行容器使用的CPU占用率和内存占用率
</code></pre>
<h2 id="三、常用其他命令"><a href="#三、常用其他命令" class="headerlink" title="三、常用其他命令"></a>三、常用其他命令</h2><p>后台启动容器</p>
<pre><code class="shell">#命令： docker run -d 镜像名
[lighthouse@VM-16-5-centos /]$ docker run -d centos

#问题docker ps,发现 centos 停止了

#常见的坑：docker容器使用后台运行，就必须要一个前台进程，docker发现没有应用，就会自动停止。
#nginx容器启动后，发现自己没有提供服务就会立刻停止，就是没有程序了。
</code></pre>
<p>查看日志</p>
<pre><code class="shell">sudo docker logs -tf --tail 日志数量 容器id
#选项
-tf           #显示日志
--tail number #number：想要显示的日志数量
</code></pre>
<p>查看容器中的进程信息</p>
<pre><code class="shell">#查看容器的进程信息
sudo docker top 容器id
</code></pre>
<p>查看镜像的元数据</p>
<pre><code>#查看镜像的信息
sudo docker image inspect 镜像名:tag
#查看运行容器的信息
sudo docker inspect 容器id
</code></pre>
<p>进入当前正在运行的容器</p>
<pre><code>#我们通常容器都是使用后台方式运行的，需要进入容器，修改配置。
#命令一
sudo docker exec -it 容器id /bin/bash  #进入容器后开启一个新的终端，可以在里面操作（常用）
#命令二
sudo docker attach 容器id   #进入容器正在执行的终端，不会启动新的进程。
</code></pre>
<p>从容器内拷贝文件到主机上</p>
<pre><code>sudo docker cp 容器id:容器内路径 目的的主机路径
</code></pre>
<h2 id="四、作业练习"><a href="#四、作业练习" class="headerlink" title="四、作业练习"></a>四、作业练习</h2><h3 id="1-docker-安装-nginx"><a href="#1-docker-安装-nginx" class="headerlink" title="1.docker 安装 nginx"></a>1.docker 安装 nginx</h3><pre><code class="shell">#搜索镜像
[lighthouse@VM-16-5-centos /]$ sudo docker search nginx
NAME                                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
nginx                                             Official build of Nginx.                        18074     [OK]       
bitnami/nginx                                     Bitnami nginx Docker Image                      150                  [OK]
bitnami/nginx-ingress-controller                  Bitnami Docker Image for NGINX Ingress Contr…   23                   [OK]
ubuntu/nginx                                      Nginx, a high-performance reverse proxy &amp; we…   77                   
kasmweb/nginx                                     An Nginx image based off nginx:alpine and in…   4                    
rancher/nginx-ingress-controller                                                                  11                   
rancher/nginx-ingress-controller-defaultbackend                                                   2                    
bitnami/nginx-exporter                                                                            3                    
rancher/nginx                                                                                     2                    
ibmcom/nginx-ingress-controller                   Docker Image for IBM Cloud Private-CE (Commu…   4                    
rapidfort/nginx-ib                                RapidFort optimized, hardened image for NGIN…   0                    
vmware/nginx-photon                                                                               1                    
rapidfort/nginx                                   RapidFort optimized, hardened image for NGINX   2                    
ibmcom/nginx-ingress-controller-ppc64le           Docker Image for IBM Cloud Private-CE (Commu…   0                    
bitnami/nginx-ldap-auth-daemon                                                                    3                    
ibmcom/nginx-ppc64le                              Docker image for nginx-ppc64le                  0                    
vmware/nginx                                                                                      2                    
rancher/nginx-conf                                                                                0                    
rapidfort/nginx-official                          RapidFort optimized, hardened image for NGIN…   1                    
linuxserver/nginx                                 An Nginx container, brought to you by LinuxS…   184                  
privatebin/nginx-fpm-alpine                       PrivateBin running on an Nginx, php-fpm &amp; Al…   72                   [OK]
bitnami/nginx-intel                                                                               1                    
rancher/nginx-ssl                                                                                 0                    
circleci/nginx                                    This image is for internal use                  2                    
continuumio/nginx-ingress-ws                                                                      0            
#下载镜像
[lighthouse@VM-16-5-centos /]$ sudo docker pull nginx
Using default tag: latest
latest: Pulling from library/nginx
bb263680fed1: Already exists 
258f176fd226: Pull complete 
a0bc35e70773: Pull complete 
077b9569ff86: Pull complete 
3082a16f3b61: Pull complete 
7e9b29976cce: Pull complete 
Digest: sha256:6650513efd1d27c1f8a5351cbd33edf85cc7e0d9d0fcb4ffb23d8fa89b601ba8
Status: Downloaded newer image for nginx:latest
docker.io/library/nginx:latest
#运行镜像
[lighthouse@VM-16-5-centos /]$ sudo docker run -d --name nginx01 -p 3344:80 nginx
62922997834fabe72a1051794ac449392d8649cb4de930a8f3afe54c9a086c38
#查看镜像是否运行
[lighthouse@VM-16-5-centos /]$​ sudo docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES
62922997834f   nginx     &quot;/docker-entrypoint.…&quot;   20 seconds ago   Up 19 seconds   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01
#访问本机3344端口，测试镜像是否运行成功
[lighthouse@VM-16-5-centos /]$ curl localhost:3344

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
html &#123; color-scheme: light dark; &#125;
body &#123; width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; &#125;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;


&lt;p&gt;For online documentation and support please refer to
&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
#进入容器
[lighthouse@VM-16-5-centos /]$ sudo docker exec -it 62922997834f /bin/bash
root@62922997834f:/# 
#查看容器路径及内容
root@62922997834f:/# whereis nginx
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
root@62922997834f:/# cd /etc/nginx
root@62922997834f:/etc/nginx# ls
conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params
#退出容器
root@62922997834f:/# exit
exit
[lighthouse@VM-16-5-centos /]$
</code></pre>
<h3 id="2、docker-安装-tomcat"><a href="#2、docker-安装-tomcat" class="headerlink" title="2、docker 安装 tomcat"></a>2、docker 安装 tomcat</h3><pre><code class="shell">#官方的使用
docker run -it --rm tomcat:9.0
#我们之前启动都是后台，停止了容器之后，容器还可以查到。docker run -it --rm tomcat:9.0 一般用来测试，用完即删。

#我们使用后台启动
#下载tomcat镜像
[lighthouse@VM-16-5-centos /]$ sudo docker pull tomcat:9.0
9.0: Pulling from library/tomcat
10ac4908093d: Pull complete 
6df15e605e38: Pull complete 
2db012dd504c: Pull complete 
8fa912900627: Pull complete 
f8fe20946c04: Pull complete 
1f8839e6ed79: Pull complete 
0839ea5a8b1a: Pull complete 
Digest: sha256:88d10376048d05596c7dc0d4b18b29015b4116871698facdcb1fd20c41e33cb7
Status: Downloaded newer image for tomcat:9.0
docker.io/library/tomcat:9.0

#启动容器
[lighthouse@VM-16-5-centos /]$ sudo docker run -d -p 3355:8080 --name tomcat01 tomcat:9.0
dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871

#查看容器是否启动
[lighthouse@VM-16-5-centos /]$ sudo docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED          STATUS          PORTS                                       NAMES
dcf25e61c138   tomcat:9.0   &quot;catalina.sh run&quot;   44 seconds ago   Up 43 seconds   0.0.0.0:3355-&gt;8080/tcp, :::3355-&gt;8080/tcp   tomcat01

#进入容器
[lighthouse@VM-16-5-centos /]$ sudo docker exec -it tomcat01 /bin/bash
root@dcf25e61c138:/usr/local/tomcat# ls
bin  BUILDING.txt  conf  CONTRIBUTING.md  lib  LICENSE  logs  native-jni-lib  NOTICE  README.md  RELEASE-NOTES  RUNNING.txt  temp  webapps  webapps.dist  work
root@dcf25e61c138:/usr/local/tomcat# ls -al
total 172
drwxr-xr-x 1 root root  4096 Feb  1 02:41 .
drwxr-xr-x 1 root root  4096 Feb  1 02:37 ..
drwxr-xr-x 2 root root  4096 Feb  1 02:41 bin
-rw-r--r-- 1 root root 19992 Jan  9 22:33 BUILDING.txt
drwxr-xr-x 1 root root  4096 Feb 13 06:32 conf
-rw-r--r-- 1 root root  6210 Jan  9 22:33 CONTRIBUTING.md
drwxr-xr-x 2 root root  4096 Feb  1 02:41 lib
-rw-r--r-- 1 root root 57092 Jan  9 22:33 LICENSE
drwxrwxrwx 1 root root  4096 Feb 13 06:32 logs
drwxr-xr-x 2 root root  4096 Feb  1 02:41 native-jni-lib
-rw-r--r-- 1 root root  2333 Jan  9 22:33 NOTICE
-rw-r--r-- 1 root root  3398 Jan  9 22:33 README.md
-rw-r--r-- 1 root root  6901 Jan  9 22:33 RELEASE-NOTES
-rw-r--r-- 1 root root 16505 Jan  9 22:33 RUNNING.txt
drwxrwxrwx 2 root root  4096 Feb  1 02:41 temp
drwxr-xr-x 2 root root  4096 Feb  1 02:41 webapps
drwxr-xr-x 7 root root  4096 Jan  9 22:33 webapps.dist
drwxrwxrwx 2 root root  4096 Jan  9 22:33 work
root@dcf25e61c138:/usr/local/tomcat# cd webapps
#进入webapps文件夹发现没有文件
root@dcf25e61c138:/usr/local/tomcat/webapps# ls
root@dcf25e61c138:/usr/local/tomcat/webapps# cd ..
#进入webapps.dist文件夹发现tomcat页面文件在这
root@dcf25e61c138:/usr/local/tomcat# cd webapps.dist/
root@dcf25e61c138:/usr/local/tomcat/webapps.dist# ls
docs  examples  host-manager  manager  ROOT
root@dcf25e61c138:/usr/local/tomcat/webapps.dist# cd ..
#将webapps.dist目录下的所有文件拷贝到webapps目录
root@dcf25e61c138:/usr/local/tomcat# cp -r webapps.dist/* webapps
root@dcf25e61c138:/usr/local/tomcat# cd webapps
root@dcf25e61c138:/usr/local/tomcat/webapps# ls -al
total 32
drwxr-xr-x  1 root root 4096 Feb 13 06:46 .
drwxr-xr-x  1 root root 4096 Feb  1 02:41 ..
drwxr-xr-x 15 root root 4096 Feb 13 06:46 docs
drwxr-xr-x  7 root root 4096 Feb 13 06:46 examples
drwxr-xr-x  6 root root 4096 Feb 13 06:46 host-manager
drwxr-xr-x  6 root root 4096 Feb 13 06:46 manager
drwxr-xr-x  3 root root 4096 Feb 13 06:46 ROOT
root@dcf25e61c138:/usr/local/tomcat/webapps# 
#此时访问3355端口就会出现tomcat初始欢迎页面

#退出容器
root@dcf25e61c138:/usr/local/tomcat# exit
exit
</code></pre>
<h3 id="3、docker-安装-portainer"><a href="#3、docker-安装-portainer" class="headerlink" title="3、docker 安装 portainer"></a>3、docker 安装 portainer</h3><p>什么是 portainer？</p>
<p>Docker 图形化界面管理工具！提供一个后台面板供我们操作！</p>
<pre><code class="shell">#安装并运行portainer容器
sudo docker run -d -p 8088:9000 \
--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer
访问 https://ip:8088，出现登录界面，设置密码并登录，选择连接本地 docker，就可以管理 docker 了！
</code></pre>
<h2 id="五、Docker-镜像讲解"><a href="#五、Docker-镜像讲解" class="headerlink" title="五、Docker 镜像讲解"></a>五、Docker 镜像讲解</h2><h3 id="1、commit-镜像"><a href="#1、commit-镜像" class="headerlink" title="1、commit 镜像"></a>1、commit 镜像</h3><pre><code class="shell">docker commit 提交容器成为一个新的副本

#命令和git原理类似
docker commit -a=&quot;作者&quot; -m=&quot;提交的描述信息&quot; 容器id 目标镜像名:[tag]



#实践
#下载一个tomcat官方镜像，并运行镜像，发现webapps里没有文件。

#将镜像里的webapps.dist目录里的文件拷贝到webapps目录。

#将修改后的容器提交到本地docker镜像库，使用 docker images 发现已经提交到本地docker镜像库。

#作用
#可以将当前容器的状态，内容保存，相当于版本控制器。
</code></pre>
<h2 id="六、容器数据卷"><a href="#六、容器数据卷" class="headerlink" title="六、容器数据卷"></a>六、容器数据卷</h2><blockquote>
<p>[!NOTE]</p>
<p>方式一：直接使用命令来挂载 -v</p>
<p>-v 表示将主机目录挂载到容器目录</p>
</blockquote>
<pre><code>sudo docker run -it -v 主机目录:容器内目录

#测试
sudo docker run -it -v /home/ceshi:/home centos /bin/bash
</code></pre>
<h3 id="实战：Docker-安装-MySQL"><a href="#实战：Docker-安装-MySQL" class="headerlink" title="实战：Docker 安装 MySQL"></a>实战：Docker 安装 MySQL</h3><p>思考：MySQL 的数据持久化问题 mysql 数据都存储在 data 目录，需要将 data 目录映射到主机。</p>
<pre><code class="shell">
#获取镜像
sudo docker pull mysql:5.7
#运行镜像(安装启动mysql时，需要配置密码，这是需要注意的一点)
#官方示列(-e 表示要配置容器环境，-e MYSQL_ROOT_PASSWORD=root 表示配置mysql的密码为root)
docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag

#测试
-d 后台启动
-p 端口映射
-v 卷挂载
-e 环境配置
--name 容器名称

sudo docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7

#启动之后在本地用Navicat连接测试。
</code></pre>
<h3 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h3><pre><code class="shell">#匿名挂载
-v 容器内路径
#示列
sudo docker run -d -P --name nginx01 -v /etc/nginx nginx
#查看所有的卷（volume）的情况
sudo docker volume ls
#结果
[lighthouse@VM-16-5-centos /]$ sudo docker volume ls
DRIVER    VOLUME NAME
local     e2811eb1e2b4fad36ecf478e91e8ffc6f1c87f389266e29d2c73111631eacf52
#这里发现-v 后面只写了容器内路径，没有写主机路径,得到的卷名是一串哈希值。

#具名挂载
-v 主机目录:容器内目录
#示列
sudo docker run -d -P --name nginx02 -v juming_nginx:/etc/nginx nginx
#查看所有的卷（volume）的情况
sudo docker volume ls
#这里发现 -v 卷名:容器内路径,得到的卷名是指定的juming_nginx。

#查看卷的信息
sudo docker volume inspect 卷名
#结果
[lighthouse@VM-16-5-centos /]$ sudo docker volume inspect e2811eb1e2b4fad36ecf478e91e8ffc6f1c87f389266e29d2c73111631eacf52
[
    &#123;
        &quot;CreatedAt&quot;: &quot;2023-02-12T17:47:52+08:00&quot;,
        &quot;Driver&quot;: &quot;local&quot;,
        &quot;Labels&quot;: null,
        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/e2811eb1e2b4fad36ecf478e91e8ffc6f1c87f389266e29d2c73111631eacf52/_data&quot;,
        &quot;Name&quot;: &quot;e2811eb1e2b4fad36ecf478e91e8ffc6f1c87f389266e29d2c73111631eacf52&quot;,
        &quot;Options&quot;: null,
        &quot;Scope&quot;: &quot;local&quot;
    &#125;
]
</code></pre>
<p>所有的 docker 容器内的卷，没有指定目录的情况下，所有的卷数据都是存储在 &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;xxx卷名&#x2F;_data 目录下。</p>
<p>我们通过具名挂载可以方便的找到我们的一个卷，大多数情况使用具名挂载。</p>
<pre><code class="shell"># 如何确定是具名挂载还是匿名挂载，还是指定路径挂载。

-v 容器内路径            #匿名挂载
-v 卷名:容器内路径        #具名挂载
-v /主机路径:容器内路径    #指定路径挂载
</code></pre>
<p>拓展：</p>
<pre><code class="shell">#通过 -v 容器内路径:ro|rw 改变读写权限
ro readonly   #只读
rw readwrite  #可读可写

#一旦设置了这个容器只读权限，容器对我们挂载出来的内容就有限定了！
sudo docker run -d -P --name nginx02 -v juming_nginx:/etc/nginx:ro nginx

sudo docker run -d -P --name nginx02 -v juming_nginx:/etc/nginx:rw nginx

#ro 只要看到ro就说明这个路径内容只能通过宿主机操作，容器内部无法操作。
</code></pre>
<h3 id="初识-Dockerfile"><a href="#初识-Dockerfile" class="headerlink" title="初识 Dockerfile"></a>初识 Dockerfile</h3><p>Dockerfile 就是用来构建 docker 镜像的构建文件，即命令脚本！</p>
<h3 id="通过脚本生成镜像"><a href="#通过脚本生成镜像" class="headerlink" title="通过脚本生成镜像"></a>通过脚本生成镜像</h3><p>编写 Dockerfile 脚本文件</p>
<pre><code class="shell">#创建一个dockerfile文件，名字可以随机，建议Dockerfile。
#文件中的内容: 指令(大写) 参数

#基于CentOS镜像
FROM centos
#挂载数据卷（只写了容器内路径，是匿名挂载，挂载在宿主机的 `/var/lib/docker/volumes/xxx卷名/_data` 目录下）
VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]
#结束了可以打印提示信息
CMD echo &quot;---------end------------&quot;
#构建好后进入bash控制台
CMD /bin/bash

#这里的每个命令，就是镜像的一层！
</code></pre>
<p>在 dockerfile 文件所在的路径运行脚本构建镜像</p>
<pre><code class="shell">#注意命令结尾有一个（ . ）。
sudo docker build -f dockerfile文件的路径 -t 自定义镜像名:tag .
</code></pre>
<p>通过 sudo docker images 查看镜像是否生成成功！</p>
<p>这种通过镜像挂载卷的方式使用的十分多，因为我们会经常构建自己的镜像。如果构建镜像时没有挂载卷，要手动挂载就通过 -v 命令进行挂载。</p>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p>实现容器的数据卷共享，列如多个 mysql 同步配置文件。</p>
<pre><code class="shell">#命令
子容器 --volumes-from 父容器

#测试
sudo docker run -d -P --name centos01 -v ceshi:/volume01 centos
sudo docker run -d -P --name centos02 --volumes-from centos01 centos
</code></pre>
<p>结论：使用数据卷容器可以实现容器之间配置信息的传递与共享！数据卷容器的生命周期可以一直持续到没有容器使用为止！但是一旦你持久化本地，这个时候，本地的数据是不会被删除的！</p>
<h2 id="七、Dockerfile"><a href="#七、Dockerfile" class="headerlink" title="七、Dockerfile"></a>七、Dockerfile</h2><p>dockerfile 是用来构建 docker 镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<ol>
<li><p>编写一个 dockerfile 文件</p>
</li>
<li><p>docker build 构建成一个镜像</p>
</li>
<li><p>docker run 运行镜像</p>
</li>
<li><p>docker push 发布镜像（DockerHub、阿里云仓库）</p>
</li>
</ol>
<h3 id="Dockerfile-的指令"><a href="#Dockerfile-的指令" class="headerlink" title="Dockerfile 的指令"></a>Dockerfile 的指令</h3><pre><code class="shell">FROM         #基础镜像，一切从这里构建
MAINTAINER   #镜像是谁写的，姓名+邮箱
RUN          #镜像构建的时候需要运行的命令
ADD          #添加内容，比如制作tomcat镜像，需要添加tomcat压缩包
WORKDIR      #镜像的工作目录。
VOLUME       #设置卷，挂载主机目录
EXPOSE       #指定暴露对外端口
CMD          #指定这个容器启动的时候要运行的命令，与ENTRYPOINT区别（只有最后一个会生效，可被替代）
ENTRYPOINT   #指定这个容器启动的时候要运行的命令
ONBUILD      #当构建一个被继承 Dockerfile，这个指令被触发。ONBUILD是一个特殊的指令它后面跟的是其它指令，比如 RUN, COPY 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。
COPY         #类似ADD命令，将我们的文件拷贝到镜像中，但不会自动解压。
LABEL        #设置镜像的信息
ENV          #构建的时候设置环境变量
</code></pre>
<blockquote>
<p>[!TIP]</p>
<p>CMD 和 ENTRYPOINT 的区别：</p>
<pre><code class="shell">CMD          #指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。
ENTRYPOINT   #指定这个容器启动的时候要运行的命令，可以追加命令。
</code></pre>
</blockquote>
<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><p>DockerHub 中 99% 镜像都是从这个基础镜像过来的 FROM scratch，然后配置需要的软件和配置来进行构建。</p>
<p>创建一个自己的 centos 镜像：</p>
<ul>
<li>编写 dockerfile 文件：</li>
</ul>
<pre><code class="shell">FROM centos:7       #基于centos7镜像
MAINTAINER qiancheng&lt;zehong.zhang@qq.com&gt;   #作者+邮箱

#设置环境和工作路径
ENV MYPATH /usr/local
WORKDIR $MYPATH

#为centos7基础镜像添加vim和net-tools
RUN yum -y install vim
RUN yum -y install net-tools

#暴露80端口
EXPOSE 80

CMD [&quot;/bin/bash&quot;]   #进入bash
</code></pre>
<ul>
<li>通过 dockerfile 文件构建镜像：</li>
</ul>
<pre><code class="shell">#通过dockerfile文件构建镜像
sudo docker build -f dockerfile文件路径 -t 镜像名:[tag] .
#查看生成的镜像
sudo docker images
</code></pre>
<ul>
<li>查看镜像的构建步骤：</li>
</ul>
<pre><code class="shell">sudo docker history 镜像id
</code></pre>
<p>我们以后开发步骤：需要掌握 Dockerfile 的编写，我们之后的一切都是使用 docker 镜像发布运行！</p>
<h3 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h3><blockquote>
<p>[!CAUTION]</p>
<p>DockerHub</p>
</blockquote>
<p>1、地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/%EF%BC%8C%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%A6%E5%8F%B7%EF%BC%81">https://hub.docker.com/，注册自己的账号！</a></p>
<p>2、确定这个账号可以登录</p>
<p>3、在我们的服务器上提交自己的镜像</p>
<pre><code class="shell">#登录DockerHub账号
[lighthouse@VM-16-5-centos local]$ sudo docker login --help

Usage:  docker login [OPTIONS] [SERVER]

Log in to a registry.
If no server is specified, the default is defined by the daemon.

Options:
  -p, --password string   Password
      --password-stdin    Take the password from stdin
  -u, --username string   Username

  #登录账号
  sudo docker login -u #之后提示输入密码
</code></pre>
<p>4、登录成功后就可以提交镜像了</p>
<pre><code class="shell">sudo docker tag 镜像id DockerHub的用户名/镜像名:tag
sudo docker push DockerHub的用户名/镜像名:tag
</code></pre>
<p>5、退出登录</p>
<pre><code class="shell">sudo docker logout
</code></pre>
<h2 id="八、Docker-网络"><a href="#八、Docker-网络" class="headerlink" title="八、Docker 网络"></a>八、Docker 网络</h2><h3 id="理解-Docker0"><a href="#理解-Docker0" class="headerlink" title="理解 Docker0"></a>理解 Docker0</h3><pre><code class="shell">#Linux里查看本机ip地址
ip addr
ifconfig

[root@VM-16-5-centos /]# ip addr   （或者ifconfig）
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 52:54:00:3f:4f:1c brd ff:ff:ff:ff:ff:ff
    inet 10.0.16.5/22 brd 10.0.19.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe3f:4f1c/64 scope link 
       valid_lft forever preferred_lft forever
3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:d2:14:5c:09 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:d2ff:fe14:5c09/64 scope link 
       valid_lft forever preferred_lft forever
       
#测试是否能ping通docker0
[root@VM-16-5-centos /]# ping 172.17.0.1
PING 172.17.0.1 (172.17.0.1) 56(84) bytes of data.
64 bytes from 172.17.0.1: icmp_seq=1 ttl=64 time=0.039 ms
64 bytes from 172.17.0.1: icmp_seq=2 ttl=64 time=0.041 ms
64 bytes from 172.17.0.1: icmp_seq=3 ttl=64 time=0.042 ms
64 bytes from 172.17.0.1: icmp_seq=4 ttl=64 time=0.036 ms
^C
--- 172.17.0.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3000ms
rtt min/avg/max/mdev = 0.036/0.039/0.042/0.006 ms

#查看tomcat容器相关信息
[root@VM-16-5-centos /]# docker inspect dcf25e61c138
[
    &#123;
        &quot;Id&quot;: &quot;dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871&quot;,
        &quot;Created&quot;: &quot;2023-02-13T06:32:31.773322109Z&quot;,
        &quot;Path&quot;: &quot;catalina.sh&quot;,
        &quot;Args&quot;: [
            &quot;run&quot;
        ],
        &quot;State&quot;: &#123;
            &quot;Status&quot;: &quot;running&quot;,
            &quot;Running&quot;: true,
            &quot;Paused&quot;: false,
            &quot;Restarting&quot;: false,
            &quot;OOMKilled&quot;: false,
            &quot;Dead&quot;: false,
            &quot;Pid&quot;: 19517,
            &quot;ExitCode&quot;: 0,
            &quot;Error&quot;: &quot;&quot;,
            &quot;StartedAt&quot;: &quot;2023-02-18T09:58:54.860637695Z&quot;,
            &quot;FinishedAt&quot;: &quot;2023-02-13T08:05:53.824258946Z&quot;
        &#125;,
        &quot;Image&quot;: &quot;sha256:b07e16b110887760e9f0a7e2d55c9a64c1d605309bddcd56c95749c91513d451&quot;,
        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871/resolv.conf&quot;,
        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871/hostname&quot;,
        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871/hosts&quot;,
        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871/dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871-json.log&quot;,
        &quot;Name&quot;: &quot;/tomcat01&quot;,
        &quot;RestartCount&quot;: 0,
        &quot;Driver&quot;: &quot;overlay2&quot;,
        &quot;Platform&quot;: &quot;linux&quot;,
        &quot;MountLabel&quot;: &quot;&quot;,
        &quot;ProcessLabel&quot;: &quot;&quot;,
        &quot;AppArmorProfile&quot;: &quot;&quot;,
        &quot;ExecIDs&quot;: null,
        &quot;HostConfig&quot;: &#123;
            &quot;Binds&quot;: null,
            &quot;ContainerIDFile&quot;: &quot;&quot;,
            &quot;LogConfig&quot;: &#123;
                &quot;Type&quot;: &quot;json-file&quot;,
                &quot;Config&quot;: &#123;&#125;
            &#125;,
            &quot;NetworkMode&quot;: &quot;default&quot;,
            &quot;PortBindings&quot;: &#123;
                &quot;8080/tcp&quot;: [
                    &#123;
                        &quot;HostIp&quot;: &quot;&quot;,
                        &quot;HostPort&quot;: &quot;3355&quot;
                    &#125;
                ]
            &#125;,
            &quot;RestartPolicy&quot;: &#123;
                &quot;Name&quot;: &quot;no&quot;,
                &quot;MaximumRetryCount&quot;: 0
            &#125;,
            &quot;AutoRemove&quot;: false,
            &quot;VolumeDriver&quot;: &quot;&quot;,
            &quot;VolumesFrom&quot;: null,
            &quot;ConsoleSize&quot;: [
                25,
                179
            ],
            &quot;CapAdd&quot;: null,
            &quot;CapDrop&quot;: null,
            &quot;CgroupnsMode&quot;: &quot;host&quot;,
            &quot;Dns&quot;: [],
            &quot;DnsOptions&quot;: [],
            &quot;DnsSearch&quot;: [],
            &quot;ExtraHosts&quot;: null,
            &quot;GroupAdd&quot;: null,
            &quot;IpcMode&quot;: &quot;private&quot;,
            &quot;Cgroup&quot;: &quot;&quot;,
            &quot;Links&quot;: null,
            &quot;OomScoreAdj&quot;: 0,
            &quot;PidMode&quot;: &quot;&quot;,
            &quot;Privileged&quot;: false,
            &quot;PublishAllPorts&quot;: false,
            &quot;ReadonlyRootfs&quot;: false,
            &quot;SecurityOpt&quot;: null,
            &quot;UTSMode&quot;: &quot;&quot;,
            &quot;UsernsMode&quot;: &quot;&quot;,
            &quot;ShmSize&quot;: 67108864,
            &quot;Runtime&quot;: &quot;runc&quot;,
            &quot;Isolation&quot;: &quot;&quot;,
            &quot;CpuShares&quot;: 0,
            &quot;Memory&quot;: 0,
            &quot;NanoCpus&quot;: 0,
            &quot;CgroupParent&quot;: &quot;&quot;,
            &quot;BlkioWeight&quot;: 0,
            &quot;BlkioWeightDevice&quot;: [],
            &quot;BlkioDeviceReadBps&quot;: [],
            &quot;BlkioDeviceWriteBps&quot;: [],
            &quot;BlkioDeviceReadIOps&quot;: [],
            &quot;BlkioDeviceWriteIOps&quot;: [],
            &quot;CpuPeriod&quot;: 0,
            &quot;CpuQuota&quot;: 0,
            &quot;CpuRealtimePeriod&quot;: 0,
            &quot;CpuRealtimeRuntime&quot;: 0,
            &quot;CpusetCpus&quot;: &quot;&quot;,
            &quot;CpusetMems&quot;: &quot;&quot;,
            &quot;Devices&quot;: [],
            &quot;DeviceCgroupRules&quot;: null,
            &quot;DeviceRequests&quot;: null,
            &quot;MemoryReservation&quot;: 0,
            &quot;MemorySwap&quot;: 0,
            &quot;MemorySwappiness&quot;: null,
            &quot;OomKillDisable&quot;: false,
            &quot;PidsLimit&quot;: null,
            &quot;Ulimits&quot;: null,
            &quot;CpuCount&quot;: 0,
            &quot;CpuPercent&quot;: 0,
            &quot;IOMaximumIOps&quot;: 0,
            &quot;IOMaximumBandwidth&quot;: 0,
            &quot;MaskedPaths&quot;: [
                &quot;/proc/asound&quot;,
                &quot;/proc/acpi&quot;,
                &quot;/proc/kcore&quot;,
                &quot;/proc/keys&quot;,
                &quot;/proc/latency_stats&quot;,
                &quot;/proc/timer_list&quot;,
                &quot;/proc/timer_stats&quot;,
                &quot;/proc/sched_debug&quot;,
                &quot;/proc/scsi&quot;,
                &quot;/sys/firmware&quot;
            ],
            &quot;ReadonlyPaths&quot;: [
                &quot;/proc/bus&quot;,
                &quot;/proc/fs&quot;,
                &quot;/proc/irq&quot;,
                &quot;/proc/sys&quot;,
                &quot;/proc/sysrq-trigger&quot;
            ]
        &#125;,
        &quot;GraphDriver&quot;: &#123;
            &quot;Data&quot;: &#123;
                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/db58e0d55834b31ce6ef1e6e863fba188007e89f75a5b09597ac6fbcdbea8200-init/diff:/var/lib/docker/overlay2/ccdc5b6b5149fe15f86dbd7b223526471bd34b54adf2712dc516b8dfb47adb25/diff:/var/lib/docker/overlay2/d66bc61537a6126992e4e1de75b93bc9445864fd88e9b076834e72d04a928e70/diff:/var/lib/docker/overlay2/b75495e5bde09db6fd8735152a8c38fea408aa8aff1d1ebd07368e01e10c76fc/diff:/var/lib/docker/overlay2/e5105d9a6b73d9cce4b26ce79a7b7516189896aa6f78c3a0f2b37b571d753da8/diff:/var/lib/docker/overlay2/ce6466763d59debae0c1d1cbce8163318efb5dd385c5e79ef356610ffc9b9b93/diff:/var/lib/docker/overlay2/c22ea8305a7dc3d9536ea9cc8e922192e5b665c09424e2072feb589bce9c5a66/diff:/var/lib/docker/overlay2/63d30096d984ac8e42aafbc726d4907d7e1f8c3e4aeb63fc5e2df77783258548/diff&quot;,
                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/db58e0d55834b31ce6ef1e6e863fba188007e89f75a5b09597ac6fbcdbea8200/merged&quot;,
                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/db58e0d55834b31ce6ef1e6e863fba188007e89f75a5b09597ac6fbcdbea8200/diff&quot;,
                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/db58e0d55834b31ce6ef1e6e863fba188007e89f75a5b09597ac6fbcdbea8200/work&quot;
            &#125;,
            &quot;Name&quot;: &quot;overlay2&quot;
        &#125;,
        &quot;Mounts&quot;: [],
        &quot;Config&quot;: &#123;
            &quot;Hostname&quot;: &quot;dcf25e61c138&quot;,
            &quot;Domainname&quot;: &quot;&quot;,
            &quot;User&quot;: &quot;&quot;,
            &quot;AttachStdin&quot;: false,
            &quot;AttachStdout&quot;: false,
            &quot;AttachStderr&quot;: false,
            &quot;ExposedPorts&quot;: &#123;
                &quot;8080/tcp&quot;: &#123;&#125;
            &#125;,
            &quot;Tty&quot;: false,
            &quot;OpenStdin&quot;: false,
            &quot;StdinOnce&quot;: false,
            &quot;Env&quot;: [
                &quot;PATH=/usr/local/tomcat/bin:/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,
                &quot;JAVA_HOME=/opt/java/openjdk&quot;,
                &quot;LANG=en_US.UTF-8&quot;,
                &quot;LANGUAGE=en_US:en&quot;,
                &quot;LC_ALL=en_US.UTF-8&quot;,
                &quot;JAVA_VERSION=jdk-17.0.6+10&quot;,
                &quot;CATALINA_HOME=/usr/local/tomcat&quot;,
                &quot;TOMCAT_NATIVE_LIBDIR=/usr/local/tomcat/native-jni-lib&quot;,
                &quot;LD_LIBRARY_PATH=/usr/local/tomcat/native-jni-lib&quot;,
                &quot;GPG_KEYS=48F8E69F6390C9F25CFEDCD268248959359E722B A9C5DF4D22E99998D9875A5110C01C5A2F6059E7 DCFD35E0BF8CA7344752DE8B6FB21E8933C60243&quot;,
                &quot;TOMCAT_MAJOR=9&quot;,
                &quot;TOMCAT_VERSION=9.0.71&quot;,
                &quot;TOMCAT_SHA512=6a747e68eff4b68a8defba111103ef6b1606030c180143de0419d015052a5567fca1a86e3d3e058a10246c02b98e89431e9344f80475189573fa0d5c70bfb4cb&quot;
            ],
            &quot;Cmd&quot;: [
                &quot;catalina.sh&quot;,
                &quot;run&quot;
            ],
            &quot;Image&quot;: &quot;tomcat:9.0&quot;,
            &quot;Volumes&quot;: null,
            &quot;WorkingDir&quot;: &quot;/usr/local/tomcat&quot;,
            &quot;Entrypoint&quot;: null,
            &quot;OnBuild&quot;: null,
            &quot;Labels&quot;: &#123;
                &quot;org.opencontainers.image.ref.name&quot;: &quot;ubuntu&quot;,
                &quot;org.opencontainers.image.version&quot;: &quot;22.04&quot;
            &#125;
        &#125;,
        &quot;NetworkSettings&quot;: &#123;
            &quot;Bridge&quot;: &quot;&quot;,
            &quot;SandboxID&quot;: &quot;f61dadfb0c6776bad36a53022bd2eeaa50ce4146618d34d921268c594658eb88&quot;,
            &quot;HairpinMode&quot;: false,
            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,
            &quot;LinkLocalIPv6PrefixLen&quot;: 0,
            &quot;Ports&quot;: &#123;
                &quot;8080/tcp&quot;: [
                    &#123;
                        &quot;HostIp&quot;: &quot;0.0.0.0&quot;,
                        &quot;HostPort&quot;: &quot;3355&quot;
                    &#125;,
                    &#123;
                        &quot;HostIp&quot;: &quot;::&quot;,
                        &quot;HostPort&quot;: &quot;3355&quot;
                    &#125;
                ]
            &#125;,
            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/f61dadfb0c67&quot;,
            &quot;SecondaryIPAddresses&quot;: null,
            &quot;SecondaryIPv6Addresses&quot;: null,
            &quot;EndpointID&quot;: &quot;516a547df47472023b78d73c1a9fe9fdf2bfbcac22bd7b75c391cea567ac750f&quot;,
            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,
            &quot;GlobalIPv6Address&quot;: &quot;&quot;,
            &quot;GlobalIPv6PrefixLen&quot;: 0,
            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
            &quot;IPPrefixLen&quot;: 16,
            &quot;IPv6Gateway&quot;: &quot;&quot;,
            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
            &quot;Networks&quot;: &#123;
                &quot;bridge&quot;: &#123;
                    &quot;IPAMConfig&quot;: null,
                    &quot;Links&quot;: null,
                    &quot;Aliases&quot;: null,
                    &quot;NetworkID&quot;: &quot;6fd7bb30e2a8bb6aa470d07f4e98f89c9d0bcbb1f48c60b40f53b2774b4da720&quot;,
                    &quot;EndpointID&quot;: &quot;516a547df47472023b78d73c1a9fe9fdf2bfbcac22bd7b75c391cea567ac750f&quot;,
                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,
                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
                    &quot;IPPrefixLen&quot;: 16,
                    &quot;IPv6Gateway&quot;: &quot;&quot;,
                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,
                    &quot;GlobalIPv6PrefixLen&quot;: 0,
                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
                    &quot;DriverOpts&quot;: null
                &#125;
            &#125;
        &#125;
    &#125;
]

#测试是否能ping通正在运行的tomcat容器
[root@VM-16-5-centos /]# ping 172.17.0.2
PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.
64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.055 ms
64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.032 ms
64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.032 ms
64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.043 ms
^C
--- 172.17.0.2 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3000ms
rtt min/avg/max/mdev = 0.032/0.040/0.055/0.011 ms

#linux可以ping通docker容器内部，因为我们每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个网卡docker0，桥接模式，使用veth-pair技术；
</code></pre>
<pre><code class="shell">#测试docker内容器之间能否ping通，（结论：能通过容器ip来互相ping通）
docker exec -it dcf25e61c138 ping 172.17.0.3
</code></pre>
<p>结论：1、Linux 系统可以 ping 通容器内部；2、容器和容器之间可以 ping 通；3、容器之间是公用一个路由器，也就是 docker0；4、容器停止或删除这个 ip 配置便失效了；</p>
<h3 id="—link"><a href="#—link" class="headerlink" title="—link"></a>—link</h3><blockquote>
<p>[!NOTE]</p>
<p>思考一个场景，我们编写了一个微服务，database url&#x3D;ip，项目不重启，数据库 ip 换掉了，我们希望处理这个问题，可以名字来进行访问这个容器？</p>
</blockquote>
<pre><code class="shell">#我们发现通过容器名字ping不通
docker exec -it tomcat02 ping tomcat01

#如何解决呢？通过--link
docker exec -it tomcat02 --link tomcat01
docker run -d -P --name tomcat03 --link tomcat01 tomcat:9.0

#测试，发现tomcat02可以ping通tomcat01，tomcat03可以ping通tomcat01，但是这是单向的，反过来就不能ping通了。
docker exec -it tomcat02 ping tomcat01 #成功
docker exec -it tomcat03 ping tomcat01 #成功
docker exec -it tomcat01 ping tomcat02 #失败
docker exec -it tomcat01 ping tomcat03 #失败

#查看docker里的网络
[root@VM-16-5-centos /]# docker network COMMAND

Usage:  docker network COMMAND

Manage networks

Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or more networks
  ls          List networks
  prune       Remove all unused networks
  rm          Remove one or more networks

Run &#39;docker network COMMAND --help&#39; for more information on a command.

#查看所有网卡列表
docker network ls
[root@VM-16-5-centos /]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
6fd7bb30e2a8   bridge    bridge    local
03bbfbb9b664   host      host      local
1b3e4d05081a   none      null      local

#查看docker0网卡的ip配置信息
docker network inspect networkID
[root@VM-16-5-centos /]# docker network inspect 6fd7bb30e2a8
[
    &#123;
        &quot;Name&quot;: &quot;bridge&quot;,
        &quot;Id&quot;: &quot;6fd7bb30e2a8bb6aa470d07f4e98f89c9d0bcbb1f48c60b40f53b2774b4da720&quot;,
        &quot;Created&quot;: &quot;2023-02-11T16:02:52.832137135+08:00&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: &#123;
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: null,
            &quot;Config&quot;: [
                &#123;
                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,
                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;
                &#125;
            ]
        &#125;,
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: &#123;
            &quot;Network&quot;: &quot;&quot;
        &#125;,
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: &#123;
            &quot;dcf25e61c13894a0d61870fcc1ad6a4cefcb531b00e9cd5fec5f7d54971d6871&quot;: &#123;
                &quot;Name&quot;: &quot;tomcat01&quot;,
                &quot;EndpointID&quot;: &quot;516a547df47472023b78d73c1a9fe9fdf2bfbcac22bd7b75c391cea567ac750f&quot;,
                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,
                &quot;IPv6Address&quot;: &quot;&quot;
            &#125;
        &#125;,
        &quot;Options&quot;: &#123;
            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,
            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,
            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,
            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;
        &#125;,
        &quot;Labels&quot;: &#123;&#125;
    &#125;
]
</code></pre>
<p>—link 只能单向映射，容器之间要互相连通，需要互相 —link 才行，非常麻烦，所以已经不建议 —link 了。</p>
<p>这时我们需要自定义网络，不使用 docker0 的网桥方式。</p>
<p>docker0 的问题：它不支持容器名连接访问！</p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><p>查看所有的 docker 网络</p>
<pre><code class="shell">[root@VM-16-5-centos /]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
6fd7bb30e2a8   bridge    bridge    local
03bbfbb9b664   host      host      local
1b3e4d05081a   none      null      local
</code></pre>
<p>网络模式</p>
<ol>
<li><p>bridge (桥接模式)：桥接 docker（默认）</p>
</li>
<li><p>none：不配置网络</p>
</li>
<li><p>host (主机模式)：和宿主机共享网络</p>
</li>
<li><p>container：容器网络连通（用的少！）</p>
</li>
</ol>
<p>我们自定义网络也使用桥接模式！</p>
<p>测试</p>
<pre><code class="shell">[root@VM-16-5-centos /]# docker network --help

Usage:  docker network COMMAND

Manage networks

Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or more networks
  ls          List networks
  prune       Remove all unused networks
  rm          Remove one or more networks

Run &#39;docker network COMMAND --help&#39; for more information on a command.

#我们直接启动的命令 --net bridge ，而这个就是我们的docker0
docker run -d -P --name tomcat01 tomcat:9.0
docker run -d -P --name tomcat01 --net bridge tomcat:9.0  #与上一条命令一样的效果，因为默认就是使用docker0的桥接模式
#docker0特点：默认，容器名不能访问，--link可以打通连接！

#我们可以自定义网络！
#查看创建网络的命令怎样使用
[root@VM-16-5-centos /]# docker network create --help

Usage:  docker network create [OPTIONS] NETWORK

Create a network

Options:
      --attachable           Enable manual container attachment
      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])
      --config-from string   The network from which to copy the configuration
      --config-only          Create a configuration only network
  -d, --driver string        Driver to manage the Network (default &quot;bridge&quot;)
      --gateway strings      IPv4 or IPv6 Gateway for the master subnet
      --ingress              Create swarm routing-mesh network
      --internal             Restrict external access to the network
      --ip-range strings     Allocate container ip from a sub-range
      --ipam-driver string   IP Address Management Driver (default &quot;default&quot;)
      --ipam-opt map         Set IPAM driver specific options (default map[])
      --ipv6                 Enable IPv6 networking
      --label list           Set metadata on a network
  -o, --opt map              Set driver specific options (default map[])
      --scope string         Control the network&#39;s scope
      --subnet strings       Subnet in CIDR format that represents a network segment
      
      
#--driver bridge                   bridge桥接模式
#--subnet 192.168.0.0/16           子网地址
#--gateway 192.168.0.1             网关地址
#创建一个叫mynet的网络
docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
#查看一下创建的网络
docker network ls
docker network inspect mynet

#容器使用自定义的网络
docker run -d -P --name tomcat01 --net mynet tomcat:9.0
docker run -d -P --name tomcat02 --net mynet tomcat:9.0

#现在互相ping,发现不管是ping的 ip 还是 容器名 都是可直接互相访问的。实现了容器互相访问，但修复了docker0的缺点。
docker exec -it tomcat01 ping 192.168.0.3
docker exec -it tomcat02 ping 192.168.0.2
docker exec -it tomcat01 ping tomcat02
docker exec -it tomcat02 ping tomcat01
#我们自定义的网络docker都已经帮我们维护好了对应的关系，推荐我们平时这样使用网络！
</code></pre>
<p>好处：</p>
<p>Redis— 不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>MySQL— 不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h3 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h3><blockquote>
<p>[!NOTE]</p>
<p>问题：docker0 与自定义网络之间不能 ping 通。也就是不同网络之间的容器是不能直接连通的。这时候就需要进行网络连通，容器跟网络之间的打通。</p>
</blockquote>
<pre><code class="shell">#查看docker网络指令
[root@VM-16-5-centos /]# docker network COMMAND

Usage:  docker network COMMAND

Manage networks

Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or more networks
  ls          List networks
  prune       Remove all unused networks
  rm          Remove one or more networks

Run &#39;docker network COMMAND --help&#39; for more information on a command.

#使用connect指令进行网络连通
#查看connect指令用法
[root@VM-16-5-centos /]# docker network connect --help

Usage:  docker network connect [OPTIONS] NETWORK CONTAINER

Connect a container to a network

Options:
      --alias strings           Add network-scoped alias for the container
      --driver-opt strings      driver options for the network
      --ip string               IPv4 address (e.g., &quot;172.30.100.104&quot;)
      --ip6 string              IPv6 address (e.g., &quot;2001:db8::33&quot;)
      --link list               Add link to another container
      --link-local-ip strings   Add a link-local address for the container
#connect指令进行网络连通
docker network connect mynet tomcat01
#连通之后通过docker network inspect mynet命令可以看到mynet网络直接将tomcat01添加到了此网络中。
#一个容器两个ip地址
#此时使用ping 命令可以发现tomcat01可以连通mynet网络的容器。
</code></pre>
<h3 id="实战：部署-Redis-集群"><a href="#实战：部署-Redis-集群" class="headerlink" title="实战：部署 Redis 集群"></a>实战：部署 Redis 集群</h3><pre><code class="shell">#创建一个加redis的网卡
docker network create redis --subnet 172.38.0.0/16

#查看创建的网卡
[root@VM-16-5-centos /]# docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
6fd7bb30e2a8   bridge    bridge    local
03bbfbb9b664   host      host      local
1b3e4d05081a   none      null      local
e6ef4403e005   redis     bridge    local
#查看网卡信息
[root@VM-16-5-centos /]# docker network inspect redis
[
    &#123;
        &quot;Name&quot;: &quot;redis&quot;,
        &quot;Id&quot;: &quot;e6ef4403e005712f4accddf84049956edb37ecf157eeb9993fced0c08b3354a5&quot;,
        &quot;Created&quot;: &quot;2023-02-19T13:16:27.470782749+08:00&quot;,
        &quot;Scope&quot;: &quot;local&quot;,
        &quot;Driver&quot;: &quot;bridge&quot;,
        &quot;EnableIPv6&quot;: false,
        &quot;IPAM&quot;: &#123;
            &quot;Driver&quot;: &quot;default&quot;,
            &quot;Options&quot;: &#123;&#125;,
            &quot;Config&quot;: [
                &#123;
                    &quot;Subnet&quot;: &quot;172.38.0.0/16&quot;
                &#125;
            ]
        &#125;,
        &quot;Internal&quot;: false,
        &quot;Attachable&quot;: false,
        &quot;Ingress&quot;: false,
        &quot;ConfigFrom&quot;: &#123;
            &quot;Network&quot;: &quot;&quot;
        &#125;,
        &quot;ConfigOnly&quot;: false,
        &quot;Containers&quot;: &#123;&#125;,
        &quot;Options&quot;: &#123;&#125;,
        &quot;Labels&quot;: &#123;&#125;
    &#125;
]

#通过脚本创建六个Redis配置
for port in $(seq 1 6); \
do \
mkdir -p /mydata/redis/node-$&#123;port&#125;/conf
touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf
cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1$&#123;port&#125;
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF
done

#查看是否创建成功，可以看到已经创建了6个Redis配置文件
[root@VM-16-5-centos /]# cd /mydata
[root@VM-16-5-centos mydata]# ls
redis
[root@VM-16-5-centos mydata]# cd redis
[root@VM-16-5-centos redis]# ll
total 24
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-1
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-2
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-3
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-4
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-5
drwxr-xr-x 3 root root 4096 Feb 19 13:32 node-6
[root@VM-16-5-centos redis]# cd node-1/conf
[root@VM-16-5-centos conf]# ll
total 4
-rw-r--r-- 1 root root 206 Feb 19 13:32 redis.conf
[root@VM-16-5-centos conf]# cat redis.conf
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.11
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes

# 启动六个Redis容器

#模板
docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \
-v /mydata/redis/node-$&#123;port&#125;/data:/data \
-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:6.0 redis-server /etc/redis/redis.conf

#
docker run -p 6371:6379 -p 16371:16379 --name redis-1 \
-v /mydata/redis/node-1/data:/data \
-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.11 redis:6.0 redis-server /etc/redis/redis.conf

#
docker run -p 6376:6379 -p 16376:16379 --name redis-6 \
-v /mydata/redis/node-6/data:/data \
-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.16 redis:6.0 redis-server /etc/redis/redis.conf


#进入redis-1容器
docker exec -it redis-1 /bin/sh
ls #可以看到appendonly.aof持久化配置文件和nodes.conf节点配置文件
#创建一个集群
redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1

#演示结果
[root@VM-16-5-centos /]# docker exec -it redis-1 /bin/sh

# ls

appendonly.aof  nodes.conf

# redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1

&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...
&gt;&gt;&gt; Master[0] -&gt; Slots 0 - 5460
&gt;&gt;&gt; Master[1] -&gt; Slots 5461 - 10922
&gt;&gt;&gt; Master[2] -&gt; Slots 10923 - 16383
&gt;&gt;&gt; Adding replica 172.38.0.15:6379 to 172.38.0.11:6379
&gt;&gt;&gt; Adding replica 172.38.0.16:6379 to 172.38.0.12:6379
&gt;&gt;&gt; Adding replica 172.38.0.14:6379 to 172.38.0.13:6379
&gt;&gt;&gt; M: a2f87397ea9742d9e6c37406b68229e54e5e2930 172.38.0.11:6379
&gt;&gt;&gt; slots:[0-5460] (5461 slots) master
&gt;&gt;&gt; M: 43ae87e93995d5e2a6daf9c085cb287e386da50e 172.38.0.12:6379
&gt;&gt;&gt; slots:[5461-10922] (5462 slots) master
&gt;&gt;&gt; M: b4f29f904038f8657f160cfaedc6882f147c9b90 172.38.0.13:6379
&gt;&gt;&gt; slots:[10923-16383] (5461 slots) master
&gt;&gt;&gt; S: 34ed53f1ee51b99acbf5df8f948f7c1b5d89d9bf 172.38.0.14:6379
&gt;&gt;&gt; replicates b4f29f904038f8657f160cfaedc6882f147c9b90
&gt;&gt;&gt; S: 95038905f2e00ed28cb6e53760e5b5100bafad2e 172.38.0.15:6379
&gt;&gt;&gt; replicates a2f87397ea9742d9e6c37406b68229e54e5e2930
&gt;&gt;&gt; S: 6abd725c56b4d745e9873b3f584658314c97f568 172.38.0.16:6379
&gt;&gt;&gt; replicates 43ae87e93995d5e2a6daf9c085cb287e386da50e
&gt;&gt;&gt; Can I set the above configuration? (type &#39;yes&#39; to accept): yes
&gt;&gt;&gt; Nodes configuration updated
&gt;&gt;&gt; Assign a different config epoch to each node
&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
&gt;&gt;&gt; Waiting for the cluster to join
&gt;&gt;&gt; .
&gt;&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)
&gt;&gt;&gt; M: a2f87397ea9742d9e6c37406b68229e54e5e2930 172.38.0.11:6379
&gt;&gt;&gt; slots:[0-5460] (5461 slots) master
&gt;&gt;&gt; 1 additional replica(s)
&gt;&gt;&gt; M: 43ae87e93995d5e2a6daf9c085cb287e386da50e 172.38.0.12:6379
&gt;&gt;&gt; slots:[5461-10922] (5462 slots) master
&gt;&gt;&gt; 1 additional replica(s)
&gt;&gt;&gt; S: 6abd725c56b4d745e9873b3f584658314c97f568 172.38.0.16:6379
&gt;&gt;&gt; slots: (0 slots) slave
&gt;&gt;&gt; replicates 43ae87e93995d5e2a6daf9c085cb287e386da50e
&gt;&gt;&gt; S: 34ed53f1ee51b99acbf5df8f948f7c1b5d89d9bf 172.38.0.14:6379
&gt;&gt;&gt; slots: (0 slots) slave
&gt;&gt;&gt; replicates b4f29f904038f8657f160cfaedc6882f147c9b90
&gt;&gt;&gt; M: b4f29f904038f8657f160cfaedc6882f147c9b90 172.38.0.13:6379
&gt;&gt;&gt; slots:[10923-16383] (5461 slots) master
&gt;&gt;&gt; 1 additional replica(s)
&gt;&gt;&gt; S: 95038905f2e00ed28cb6e53760e5b5100bafad2e 172.38.0.15:6379
&gt;&gt;&gt; slots: (0 slots) slave
&gt;&gt;&gt; replicates a2f87397ea9742d9e6c37406b68229e54e5e2930
&gt;&gt;&gt; [OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
&gt;&gt;&gt; [OK] All 16384 slots covered.

#查看集群信息

# redis-cli -c #进入集群

127.0.0.1:6379&gt; cluster info #查看集群信息
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:504
cluster_stats_messages_pong_sent:510
cluster_stats_messages_sent:1014
cluster_stats_messages_ping_received:505
cluster_stats_messages_pong_received:504
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:1014
127.0.0.1:6379&gt; cluster nodes #查看集群节点
43ae87e93995d5e2a6daf9c085cb287e386da50e 172.38.0.12:6379@16379 master - 0 1676788078000 2 connected 5461-10922
6abd725c56b4d745e9873b3f584658314c97f568 172.38.0.16:6379@16379 slave 43ae87e93995d5e2a6daf9c085cb287e386da50e 0 1676788077000 2 connected
34ed53f1ee51b99acbf5df8f948f7c1b5d89d9bf 172.38.0.14:6379@16379 slave b4f29f904038f8657f160cfaedc6882f147c9b90 0 1676788076597 3 connected
b4f29f904038f8657f160cfaedc6882f147c9b90 172.38.0.13:6379@16379 master - 0 1676788078100 3 connected 10923-16383
95038905f2e00ed28cb6e53760e5b5100bafad2e 172.38.0.15:6379@16379 slave a2f87397ea9742d9e6c37406b68229e54e5e2930 0 1676788077699 1 connected
a2f87397ea9742d9e6c37406b68229e54e5e2930 172.38.0.11:6379@16379 myself,master - 0 1676788077000 1 connected 0-5460

#测试

# set a b

#然后将存储的节点容器停止，然后测试

# get a

#可以发现是从副节点取得的值，集群搭建成功
</code></pre>
<h2 id="SpringBoot-微服务打包-Docker-镜像"><a href="#SpringBoot-微服务打包-Docker-镜像" class="headerlink" title="SpringBoot 微服务打包 Docker 镜像"></a>SpringBoot 微服务打包 Docker 镜像</h2><p>1、构建 springboot 项目</p>
<p>2、打包应用</p>
<p>3、编写 dockerfile</p>
<p>4、构建镜像</p>
<p>5、发布运行</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>做完上述实验测试需要删除的数据挂载目录有：</p>
<p>&#x2F;home&#x2F;mysql————mysql 目录及目录下的所有文件</p>
<p>&#x2F;mydata———————-mydata 目录及目录下的所有文件</p>
<p>做完上述实验测试需要删除的 docker 网络有：redis</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://linkailang.github.io">涂良湘</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://linkailang.github.io/2025/04/05/Docker%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">https://linkailang.github.io/2025/04/05/Docker%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://linkailang.github.io" target="_blank">涂良湘</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Doceker/">Doceker</a></div><div class="post_share"><div class="social-share" data-image="/img/QQ%E5%9B%BE%E7%89%8720230422000755.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2025/04/05/Hexo%E5%8D%9A%E5%AE%A2%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0%E6%95%99%E7%A8%8B/" title="Hexo博客彻底删除文章教程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo博客彻底删除文章教程</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/QQ%E5%9B%BE%E7%89%8720230422000755.jpg" onerror="this.onerror=null;this.src='/img/avatar.png'" alt="avatar"/></div><div class="author-info__name">涂良湘</div><div class="author-info__description">涂良湘的个人博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2698508226@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">涂良湘的博客</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">Docker 基础入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81CentOS7-%E5%AE%89%E8%A3%85-Docker"><span class="toc-number">1.1.</span> <span class="toc-text">一、CentOS7 安装 Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">二、Docker 的基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.</span> <span class="toc-text">容器命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">三、常用其他命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BD%9C%E4%B8%9A%E7%BB%83%E4%B9%A0"><span class="toc-number">1.4.</span> <span class="toc-text">四、作业练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-docker-%E5%AE%89%E8%A3%85-nginx"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.docker 安装 nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81docker-%E5%AE%89%E8%A3%85-tomcat"><span class="toc-number">1.4.2.</span> <span class="toc-text">2、docker 安装 tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81docker-%E5%AE%89%E8%A3%85-portainer"><span class="toc-number">1.4.3.</span> <span class="toc-text">3、docker 安装 portainer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Docker-%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">五、Docker 镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81commit-%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、commit 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.</span> <span class="toc-text">六、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9ADocker-%E5%AE%89%E8%A3%85-MySQL"><span class="toc-number">1.6.1.</span> <span class="toc-text">实战：Docker 安装 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.6.2.</span> <span class="toc-text">具名和匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86-Dockerfile"><span class="toc-number">1.6.3.</span> <span class="toc-text">初识 Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%84%9A%E6%9C%AC%E7%94%9F%E6%88%90%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.4.</span> <span class="toc-text">通过脚本生成镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.6.5.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Dockerfile"><span class="toc-number">1.7.</span> <span class="toc-text">七、Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">1.7.1.</span> <span class="toc-text">Dockerfile 的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">实战测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.3.</span> <span class="toc-text">发布自己的镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">1.8.</span> <span class="toc-text">八、Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3-Docker0"><span class="toc-number">1.8.1.</span> <span class="toc-text">理解 Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%94link"><span class="toc-number">1.8.2.</span> <span class="toc-text">—link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.8.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.8.4.</span> <span class="toc-text">网络连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2-Redis-%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.5.</span> <span class="toc-text">实战：部署 Redis 集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85-Docker-%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.</span> <span class="toc-text">SpringBoot 微服务打包 Docker 镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.10.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/05/Docker%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" title="Docker基础入门">Docker基础入门</a><time datetime="2025-04-05T14:31:34.000Z" title="发表于 2025-04-05 22:31:34">2025-04-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/05/Hexo%E5%8D%9A%E5%AE%A2%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4%E6%96%87%E7%AB%A0%E6%95%99%E7%A8%8B/" title="Hexo博客彻底删除文章教程">Hexo博客彻底删除文章教程</a><time datetime="2025-04-05T13:52:08.000Z" title="发表于 2025-04-05 21:52:08">2025-04-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/27/%E7%A4%BA%E6%B3%A2%E5%99%A8%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="示波器使用方法">示波器使用方法</a><time datetime="2025-03-27T13:45:42.000Z" title="发表于 2025-03-27 21:45:42">2025-03-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/27/%E6%89%8B%E7%AE%97%E9%A2%98/" title="无题">无题</a><time datetime="2025-03-27T13:44:14.935Z" title="发表于 2025-03-27 21:44:14">2025-03-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/22/%E6%96%B0%E7%94%B5%E8%84%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="新电脑环境配置">新电脑环境配置</a><time datetime="2025-03-22T02:21:06.000Z" title="发表于 2025-03-22 10:21:06">2025-03-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 涂良湘</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><div class="container" id="jsi-flying-fish-container"><script src="js/fish.js"></script></div><style>   @media only screen and (max-width: 767px){
   #sidebar_search_box input[type=text]{width:calc(100% - 24px)}
}</style></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js"></script><script src="https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script src="/js/sakura.js"></script><script src="/js/timing.js"></script><script src="/js/yunxing.js"></script><script defer src="https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js"></script><script defer data-pjax src="/js/ripples.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div><div class="pjax-reload"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeInLeft');
    arr[i].setAttribute('data-wow-duration', '600ms');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeInRightBig');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer="defer" src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer="defer" src="/js/wow_init.js"></script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeInLeft');
    arr[i].setAttribute('data-wow-duration', '600ms');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeInRightBig');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end -->
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>